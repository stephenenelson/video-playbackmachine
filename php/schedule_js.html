<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
<title>BayCon Schedule 2006</title>
<script type="text/javascript">
window.onload=function()
{
	addTimeNodes();
	var schedule_node = document.getElementById("schedule");
	var schedule_entries = getScheduleEntries();

	for (var idx=0; idx < 4; idx++) {
		var schedule_day_node = document.createElement('div');
		schedule_day_node.className = 'schedule-day';
		addScheduleNodes(idx, schedule_day_node, schedule_entries);
		schedule_node.appendChild(schedule_day_node);
	}
}

function addTimeNodes()
{
	var hour_px = (2800  / 24);

	var time_node = document.getElementById('times');
	for (var hour=0; hour <= 23; hour++) {
		var hour_node = document.createElement('p');
		hour_node.className = 'schedule-time';
		hour_node.style.top = (hour * hour_px) + 'px';
		hour_node.style.height = hour_px + 'px';
		hour_node.appendChild( document.createTextNode( hour + ':00' ) );
		time_node.appendChild( hour_node );
	}
}

function addScheduleNodes(idx, schedule_day_node, schedule_entries)
{
	var day_start_time = 1148626800 + ( 60 * 60 * 24 * idx);
	var day_end_time = day_start_time + (60 * 60 * 24);
		
	for (var idx in schedule_entries) {
		var entry = schedule_entries[idx];
		var end_time = entry.start_time + entry.duration;
		if ( (entry.start_time >= day_start_time && entry.start_time < day_end_time)
			|| (end_time >= day_start_time && end_time <= day_end_time)
		 ) {
			addScheduleNode(entry, day_start_time, day_end_time, schedule_day_node);
		}
	}
	
}

function addScheduleNode(entry, day_start_time, day_end_time, schedule_day_node)
{
	var scale = (2800  / (24 * 60 * 60) );
	var time_diff = entry.start_time - day_start_time;
	var duration = entry.duration;
	if (time_diff < 0) {
		duration += time_diff;
		time_diff = 0;
	}
	if ( ( time_diff + duration ) > day_end_time ) {
		duration = (day_end_time - entry.start_time);
	}
	var top = time_diff * scale;
	var height = entry.duration * scale;
	schedule_day_node.appendChild(makeScheduleDaySlot(top, height, entry.title));

}

function makeScheduleDaySlot(top, height, title)
{
	var schedule_day_slot = document.createElement('p');
	schedule_day_slot.className = 'schedule-slot';
	schedule_day_slot.style.top = top + 'px';
	schedule_day_slot.style.height = height + 'px';
	schedule_day_slot.appendChild( document.createTextNode(title) );
	schedule_day_slot.onclick=editTitle;
	return schedule_day_slot;
}

function getScheduleEntries()
{
	var schedule_entries = new Array;

	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open("GET", "http://theluggage/schedule_xml.php?schedule=BayCon+2006", true);
	xmlhttp.send(null);
	if (xmlhttp.status == 200) {
		alert("Succeeded!");
	}
	else {
		alert("Failed!");
	}
		
	return schedule_entries;
}

function ScheduleEntry(id, title, start_time, duration)
{
	this.id = id;
	this.title = title;
	this.start_time = start_time;
	this.duration = duration;
}
function editTitle(event)
{
	alert("Editing title unimplemented");
}
</script>
<style type="text/css">
div.schedule-day {
width: 20%;
float: left; 
background-color: white; 
height: 2800px; 
border: 2px dashed maroon;
}

p.schedule-slot {
	position: absolute; 
	background-color: #B0E0E6;
	width: 19%;
	vertical-align: middle;
	left: auto;
	font-size: 9px;
}

div.schedule-times {
	width: 3%;
	float: left; 
	background-color: white; 
	height: 2800px; 
	border: 2px dashed maroon;
}

p.schedule-time {
	position: absolute;
	width: 83%;
	font-size: 9px;
	border: 1px solid black;
}

</style>
</head>
<body style="background-color: #888888;">
<div id="schedule">
<div class="schedule-times" id="times">
</div>

</div>

</body>
</html>
